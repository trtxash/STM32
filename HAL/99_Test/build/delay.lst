ARM GAS  C:\Users\11655\AppData\Local\Temp\cc9GeTq9.s 			page 1


   1              		.cpu cortex-m3
   2              		.arch armv7-m
   3              		.fpu softvfp
   4              		.eabi_attribute 20, 1
   5              		.eabi_attribute 21, 1
   6              		.eabi_attribute 23, 3
   7              		.eabi_attribute 24, 1
   8              		.eabi_attribute 25, 1
   9              		.eabi_attribute 26, 1
  10              		.eabi_attribute 30, 1
  11              		.eabi_attribute 34, 1
  12              		.eabi_attribute 18, 4
  13              		.file	"delay.c"
  14              		.text
  15              	.Ltext0:
  16              		.cfi_sections	.debug_frame
  17              		.section	.text.delay_init,"ax",%progbits
  18              		.align	1
  19              		.global	delay_init
  20              		.syntax unified
  21              		.thumb
  22              		.thumb_func
  24              	delay_init:
  25              	.LVL0:
  26              	.LFB65:
  27              		.file 1 "User/Src/delay.c"
   1:User/Src/delay.c **** #include "delay.h"
   2:User/Src/delay.c **** #include "sys.h"
   3:User/Src/delay.c **** ////////////////////////////////////////////////////////////////////////////////// 	 
   4:User/Src/delay.c **** //Â¶ÇÊûúÈúÄË¶Å‰ΩøÁî®OS,ÂàôÂåÖÊã¨‰∏ãÈù¢ÁöÑÂ§¥Êñá‰ª∂Âç≥ÂèØ. 
   5:User/Src/delay.c **** #if SYSTEM_SUPPORT_OS
   6:User/Src/delay.c **** #include "includes.h"					//ucos ‰ΩøÁî®	  
   7:User/Src/delay.c **** #endif
   8:User/Src/delay.c **** //////////////////////////////////////////////////////////////////////////////////	 
   9:User/Src/delay.c **** //Êú¨Á®ãÂ∫èÂè™‰æõÂ≠¶‰π†‰ΩøÁî®ÔºåÊú™Áªè‰ΩúËÄÖËÆ∏ÂèØÔºå‰∏çÂæóÁî®‰∫éÂÖ∂ÂÆÉ‰ªª‰ΩïÁî®ÈÄî
  10:User/Src/delay.c **** //ALIENTEK STM32ÂºÄÂèëÊùø
  11:User/Src/delay.c **** //‰ΩøÁî®SysTickÁöÑÊôÆÈÄöËÆ°Êï∞Ê®°ÂºèÂØπÂª∂ËøüËøõË°åÁÆ°ÁêÜÔºàÈÄÇÂêàSTM32F10xÁ≥ªÂàóÔºâ
  12:User/Src/delay.c **** //ÂåÖÊã¨delay_us,delay_ms
  13:User/Src/delay.c **** //Ê≠£ÁÇπÂéüÂ≠ê@ALIENTEK
  14:User/Src/delay.c **** //ÊäÄÊúØËÆ∫Âùõ:www.openedv.com
  15:User/Src/delay.c **** //ÂàõÂª∫Êó•Êúü:2019/9/17
  16:User/Src/delay.c **** //ÁâàÊú¨ÔºöV1.8
  17:User/Src/delay.c **** //ÁâàÊùÉÊâÄÊúâÔºåÁõóÁâàÂøÖÁ©∂„ÄÇ
  18:User/Src/delay.c **** //Copyright(C) ÂπøÂ∑ûÂ∏ÇÊòüÁøºÁîµÂ≠êÁßëÊäÄÊúâÈôêÂÖ¨Âè∏ 2009-2019
  19:User/Src/delay.c **** //All rights reserved
  20:User/Src/delay.c **** //********************************************************************************
  21:User/Src/delay.c **** //V1.2‰øÆÊîπËØ¥Êòé
  22:User/Src/delay.c **** //‰øÆÊ≠£‰∫Ü‰∏≠Êñ≠‰∏≠Ë∞ÉÁî®Âá∫Áé∞Ê≠ªÂæ™ÁéØÁöÑÈîôËØØ
  23:User/Src/delay.c **** //Èò≤Ê≠¢Âª∂Êó∂‰∏çÂáÜÁ°Æ,ÈááÁî®do whileÁªìÊûÑ!
  24:User/Src/delay.c **** //V1.3‰øÆÊîπËØ¥Êòé
  25:User/Src/delay.c **** //Â¢ûÂä†‰∫ÜÂØπUCOSIIÂª∂Êó∂ÁöÑÊîØÊåÅ.
  26:User/Src/delay.c **** //Â¶ÇÊûú‰ΩøÁî®ucosII,delay_init‰ºöËá™Âä®ËÆæÁΩÆSYSTICKÁöÑÂÄº,‰Ωø‰πã‰∏éucosÁöÑTICKS_PER_SECÂØπÂ∫î.
  27:User/Src/delay.c **** //delay_msÂíådelay_us‰πüËøõË°å‰∫ÜÈíàÂØπucosÁöÑÊîπÈÄ†.
  28:User/Src/delay.c **** //delay_usÂèØ‰ª•Âú®ucos‰∏ã‰ΩøÁî®,ËÄå‰∏îÂáÜÁ°ÆÂ∫¶ÂæàÈ´ò,Êõ¥ÈáçË¶ÅÁöÑÊòØÊ≤°ÊúâÂç†Áî®È¢ùÂ§ñÁöÑÂÆöÊó∂Âô
  29:User/Src/delay.c **** //delay_msÂú®ucos‰∏ã,ÂèØ‰ª•ÂΩìÊàêOSTimeDlyÊù•Áî®,Âú®Êú™ÂêØÂä®ucosÊó∂,ÂÆÉÈááÁî®delay_usÂÆûÁé∞,‰ªéËÄå
  30:User/Src/delay.c **** //ÂèØ‰ª•Áî®Êù•ÂàùÂßãÂåñÂ§ñËÆæ,Âú®ÂêØÂä®‰∫Üucos‰πãÂêédelay_msÊ†πÊçÆÂª∂Êó∂ÁöÑÈïøÁü≠,ÈÄâÊã©OSTimeDlyÂÆ
  31:User/Src/delay.c **** //V1.4‰øÆÊîπËØ¥Êòé 20110929
ARM GAS  C:\Users\11655\AppData\Local\Temp\cc9GeTq9.s 			page 2


  32:User/Src/delay.c **** //‰øÆÊîπ‰∫Ü‰ΩøÁî®ucos,‰ΩÜÊòØucosÊú™ÂêØÂä®ÁöÑÊó∂ÂÄô,delay_ms‰∏≠‰∏≠Êñ≠Êó†Ê≥ïÂìçÂ∫îÁöÑbug.
  33:User/Src/delay.c **** //V1.5‰øÆÊîπËØ¥Êòé 20120902
  34:User/Src/delay.c **** //Âú®delay_usÂä†ÂÖ•ucos‰∏äÈîÅÔºåÈò≤Ê≠¢Áî±‰∫éucosÊâìÊñ≠delay_usÁöÑÊâßË°åÔºåÂèØËÉΩÂØºËá¥ÁöÑÂª∂Êó∂‰∏çÂ
  35:User/Src/delay.c **** //V1.6‰øÆÊîπËØ¥Êòé 20150109
  36:User/Src/delay.c **** //Âú®delay_msÂä†ÂÖ•OSLockNestingÂà§Êñ≠„ÄÇ
  37:User/Src/delay.c **** //V1.7‰øÆÊîπËØ¥Êòé 20150319
  38:User/Src/delay.c **** //‰øÆÊîπOSÊîØÊåÅÊñπÂºè,‰ª•ÊîØÊåÅ‰ªªÊÑèOS(‰∏çÈôê‰∫éUCOSIIÂíåUCOSIII,ÁêÜËÆ∫‰∏ä‰ªªÊÑèOSÈÉΩÂèØ‰ª•ÊîØÊåÅ
  39:User/Src/delay.c **** //Ê∑ªÂä†:delay_osrunning/delay_ostickspersec/delay_osintnesting‰∏â‰∏™ÂÆèÂÆö‰πâ
  40:User/Src/delay.c **** //Ê∑ªÂä†:delay_osschedlock/delay_osschedunlock/delay_ostimedly‰∏â‰∏™ÂáΩÊï∞
  41:User/Src/delay.c **** //V1.8‰øÆÊîπËØ¥Êòé 20150519
  42:User/Src/delay.c **** //‰øÆÊ≠£UCOSIIIÊîØÊåÅÊó∂ÁöÑ2‰∏™bugÔºö
  43:User/Src/delay.c **** //delay_tickspersecÊîπ‰∏∫Ôºödelay_ostickspersec
  44:User/Src/delay.c **** //delay_intnestingÊîπ‰∏∫Ôºödelay_osintnesting
  45:User/Src/delay.c **** //////////////////////////////////////////////////////////////////////////////////  
  46:User/Src/delay.c **** 
  47:User/Src/delay.c **** static u32 fac_us=0;							//usÂª∂Êó∂ÂÄç‰πòÊï∞
  48:User/Src/delay.c **** 
  49:User/Src/delay.c **** #if SYSTEM_SUPPORT_OS		
  50:User/Src/delay.c ****     static u16 fac_ms=0;				        //msÂª∂Êó∂ÂÄç‰πòÊï∞,Âú®os‰∏ã,‰ª£Ë°®ÊØè‰∏™ËäÇÊãçÁöÑmsÊï∞
  51:User/Src/delay.c **** #endif
  52:User/Src/delay.c **** 	
  53:User/Src/delay.c **** #if SYSTEM_SUPPORT_OS							//Â¶ÇÊûúSYSTEM_SUPPORT_OSÂÆö‰πâ‰∫Ü,ËØ¥ÊòéË¶ÅÊîØÊåÅOS‰∫Ü(‰∏çÈôê‰∫éUCOS).
  54:User/Src/delay.c **** //ÂΩìdelay_us/delay_msÈúÄË¶ÅÊîØÊåÅOSÁöÑÊó∂ÂÄôÈúÄË¶Å‰∏â‰∏™‰∏éOSÁõ∏ÂÖ≥ÁöÑÂÆèÂÆö‰πâÂíåÂáΩÊï∞Êù•ÊîØÊåÅ
  55:User/Src/delay.c **** //È¶ñÂÖàÊòØ3‰∏™ÂÆèÂÆö‰πâ:
  56:User/Src/delay.c **** //    delay_osrunning:Áî®‰∫éË°®Á§∫OSÂΩìÂâçÊòØÂê¶Ê≠£Âú®ËøêË°å,‰ª•ÂÜ≥ÂÆöÊòØÂê¶ÂèØ‰ª•‰ΩøÁî®Áõ∏ÂÖ≥ÂáΩÊï
  57:User/Src/delay.c **** //delay_ostickspersec:Áî®‰∫éË°®Á§∫OSËÆæÂÆöÁöÑÊó∂ÈíüËäÇÊãç,delay_initÂ∞ÜÊ†πÊçÆËøô‰∏™ÂèÇÊï∞Êù•ÂàùÂßãÂ
  58:User/Src/delay.c **** // delay_osintnesting:Áî®‰∫éË°®Á§∫OS‰∏≠Êñ≠ÂµåÂ•óÁ∫ßÂà´,Âõ†‰∏∫‰∏≠Êñ≠ÈáåÈù¢‰∏çÂèØ‰ª•Ë∞ÉÂ∫¶,delay_ms‰Ω
  59:User/Src/delay.c **** //ÁÑ∂ÂêéÊòØ3‰∏™ÂáΩÊï∞:
  60:User/Src/delay.c **** //  delay_osschedlock:Áî®‰∫éÈîÅÂÆöOS‰ªªÂä°Ë∞ÉÂ∫¶,Á¶ÅÊ≠¢Ë∞ÉÂ∫¶
  61:User/Src/delay.c **** //delay_osschedunlock:Áî®‰∫éËß£ÈîÅOS‰ªªÂä°Ë∞ÉÂ∫¶,ÈáçÊñ∞ÂºÄÂêØË∞ÉÂ∫¶
  62:User/Src/delay.c **** //    delay_ostimedly:Áî®‰∫éOSÂª∂Êó∂,ÂèØ‰ª•ÂºïËµ∑‰ªªÂä°Ë∞ÉÂ∫¶.
  63:User/Src/delay.c **** 
  64:User/Src/delay.c **** //Êú¨‰æãÁ®ã‰ªÖ‰ΩúUCOSIIÂíåUCOSIIIÁöÑÊîØÊåÅ,ÂÖ∂‰ªñOS,ËØ∑Ëá™Ë°åÂèÇËÄÉÁùÄÁßªÊ§ç
  65:User/Src/delay.c **** //ÊîØÊåÅUCOSII
  66:User/Src/delay.c **** #ifdef 	OS_CRITICAL_METHOD						//OS_CRITICAL_METHODÂÆö‰πâ‰∫Ü,ËØ¥ÊòéË¶ÅÊîØÊåÅUCOSII				
  67:User/Src/delay.c **** #define delay_osrunning		OSRunning			//OSÊòØÂê¶ËøêË°åÊ†áËÆ∞,0,‰∏çËøêË°å;1,Âú®ËøêË°å
  68:User/Src/delay.c **** #define delay_ostickspersec	OS_TICKS_PER_SEC	//OSÊó∂ÈíüËäÇÊãç,Âç≥ÊØèÁßíË∞ÉÂ∫¶Ê¨°Êï∞
  69:User/Src/delay.c **** #define delay_osintnesting 	OSIntNesting		//‰∏≠Êñ≠ÂµåÂ•óÁ∫ßÂà´,Âç≥‰∏≠Êñ≠ÂµåÂ•óÊ¨°Êï∞
  70:User/Src/delay.c **** #endif
  71:User/Src/delay.c **** 
  72:User/Src/delay.c **** //ÊîØÊåÅUCOSIII
  73:User/Src/delay.c **** #ifdef 	CPU_CFG_CRITICAL_METHOD					//CPU_CFG_CRITICAL_METHODÂÆö‰πâ‰∫Ü,ËØ¥ÊòéË¶ÅÊîØÊåÅUCOSIII	
  74:User/Src/delay.c **** #define delay_osrunning		OSRunning			//OSÊòØÂê¶ËøêË°åÊ†áËÆ∞,0,‰∏çËøêË°å;1,Âú®ËøêË°å
  75:User/Src/delay.c **** #define delay_ostickspersec	OSCfg_TickRate_Hz	//OSÊó∂ÈíüËäÇÊãç,Âç≥ÊØèÁßíË∞ÉÂ∫¶Ê¨°Êï∞
  76:User/Src/delay.c **** #define delay_osintnesting 	OSIntNestingCtr		//‰∏≠Êñ≠ÂµåÂ•óÁ∫ßÂà´,Âç≥‰∏≠Êñ≠ÂµåÂ•óÊ¨°Êï∞
  77:User/Src/delay.c **** #endif
  78:User/Src/delay.c **** 
  79:User/Src/delay.c **** 
  80:User/Src/delay.c **** //usÁ∫ßÂª∂Êó∂Êó∂,ÂÖ≥Èó≠‰ªªÂä°Ë∞ÉÂ∫¶(Èò≤Ê≠¢ÊâìÊñ≠usÁ∫ßÂª∂Ëøü)
  81:User/Src/delay.c **** void delay_osschedlock(void)
  82:User/Src/delay.c **** {
  83:User/Src/delay.c **** #ifdef CPU_CFG_CRITICAL_METHOD   				//‰ΩøÁî®UCOSIII
  84:User/Src/delay.c **** 	OS_ERR err; 
  85:User/Src/delay.c **** 	OSSchedLock(&err);							//UCOSIIIÁöÑÊñπÂºè,Á¶ÅÊ≠¢Ë∞ÉÂ∫¶ÔºåÈò≤Ê≠¢ÊâìÊñ≠usÂª∂Êó∂
  86:User/Src/delay.c **** #else											//Âê¶ÂàôUCOSII
  87:User/Src/delay.c **** 	OSSchedLock();								//UCOSIIÁöÑÊñπÂºè,Á¶ÅÊ≠¢Ë∞ÉÂ∫¶ÔºåÈò≤Ê≠¢ÊâìÊñ≠usÂª∂Êó∂
  88:User/Src/delay.c **** #endif
ARM GAS  C:\Users\11655\AppData\Local\Temp\cc9GeTq9.s 			page 3


  89:User/Src/delay.c **** }
  90:User/Src/delay.c **** 
  91:User/Src/delay.c **** //usÁ∫ßÂª∂Êó∂Êó∂,ÊÅ¢Â§ç‰ªªÂä°Ë∞ÉÂ∫¶
  92:User/Src/delay.c **** void delay_osschedunlock(void)
  93:User/Src/delay.c **** {	
  94:User/Src/delay.c **** #ifdef CPU_CFG_CRITICAL_METHOD   				//‰ΩøÁî®UCOSIII
  95:User/Src/delay.c **** 	OS_ERR err; 
  96:User/Src/delay.c **** 	OSSchedUnlock(&err);						//UCOSIIIÁöÑÊñπÂºè,ÊÅ¢Â§çË∞ÉÂ∫¶
  97:User/Src/delay.c **** #else											//Âê¶ÂàôUCOSII
  98:User/Src/delay.c **** 	OSSchedUnlock();							//UCOSIIÁöÑÊñπÂºè,ÊÅ¢Â§çË∞ÉÂ∫¶
  99:User/Src/delay.c **** #endif
 100:User/Src/delay.c **** }
 101:User/Src/delay.c **** 
 102:User/Src/delay.c **** //Ë∞ÉÁî®OSËá™Â∏¶ÁöÑÂª∂Êó∂ÂáΩÊï∞Âª∂Êó∂
 103:User/Src/delay.c **** //ticks:Âª∂Êó∂ÁöÑËäÇÊãçÊï∞
 104:User/Src/delay.c **** void delay_ostimedly(u32 ticks)
 105:User/Src/delay.c **** {
 106:User/Src/delay.c **** #ifdef CPU_CFG_CRITICAL_METHOD
 107:User/Src/delay.c **** 	OS_ERR err; 
 108:User/Src/delay.c **** 	OSTimeDly(ticks,OS_OPT_TIME_PERIODIC,&err);	//UCOSIIIÂª∂Êó∂ÈááÁî®Âë®ÊúüÊ®°Âºè
 109:User/Src/delay.c **** #else
 110:User/Src/delay.c **** 	OSTimeDly(ticks);							//UCOSIIÂª∂Êó∂
 111:User/Src/delay.c **** #endif 
 112:User/Src/delay.c **** }
 113:User/Src/delay.c ****  
 114:User/Src/delay.c **** //systick‰∏≠Êñ≠ÊúçÂä°ÂáΩÊï∞,‰ΩøÁî®ucosÊó∂Áî®Âà∞
 115:User/Src/delay.c **** void SysTick_Handler(void)
 116:User/Src/delay.c **** {	
 117:User/Src/delay.c **** 	if(delay_osrunning==1)						//OSÂºÄÂßãË∑ë‰∫Ü,ÊâçÊâßË°åÊ≠£Â∏∏ÁöÑË∞ÉÂ∫¶Â§ÑÁêÜ
 118:User/Src/delay.c **** 	{
 119:User/Src/delay.c **** 		OSIntEnter();							//ËøõÂÖ•‰∏≠Êñ≠
 120:User/Src/delay.c **** 		OSTimeTick();       					//Ë∞ÉÁî®ucosÁöÑÊó∂ÈíüÊúçÂä°Á®ãÂ∫è               
 121:User/Src/delay.c **** 		OSIntExit();       	 					//Ëß¶Âèë‰ªªÂä°ÂàáÊç¢ËΩØ‰∏≠Êñ≠
 122:User/Src/delay.c **** 	}
 123:User/Src/delay.c **** }
 124:User/Src/delay.c **** #endif
 125:User/Src/delay.c **** 
 126:User/Src/delay.c **** 			   
 127:User/Src/delay.c **** //ÂàùÂßãÂåñÂª∂ËøüÂáΩÊï∞
 128:User/Src/delay.c **** //ÂΩì‰ΩøÁî®ucosÁöÑÊó∂ÂÄô,Ê≠§ÂáΩÊï∞‰ºöÂàùÂßãÂåñucosÁöÑÊó∂ÈíüËäÇÊãç
 129:User/Src/delay.c **** //SYSTICKÁöÑÊó∂ÈíüÂõ∫ÂÆö‰∏∫AHBÊó∂Èíü
 130:User/Src/delay.c **** //SYSCLK:Á≥ªÁªüÊó∂ÈíüÈ¢ëÁéá
 131:User/Src/delay.c **** void delay_init(u8 SYSCLK)
 132:User/Src/delay.c **** {
  28              		.loc 1 132 1 view -0
  29              		.cfi_startproc
  30              		@ args = 0, pretend = 0, frame = 0
  31              		@ frame_needed = 0, uses_anonymous_args = 0
  32              		.loc 1 132 1 is_stmt 0 view .LVU1
  33 0000 10B5     		push	{r4, lr}
  34              	.LCFI0:
  35              		.cfi_def_cfa_offset 8
  36              		.cfi_offset 4, -8
  37              		.cfi_offset 14, -4
  38 0002 0446     		mov	r4, r0
 133:User/Src/delay.c **** #if SYSTEM_SUPPORT_OS 						//Â¶ÇÊûúÈúÄË¶ÅÊîØÊåÅOS.
 134:User/Src/delay.c **** 	u32 reload;
ARM GAS  C:\Users\11655\AppData\Local\Temp\cc9GeTq9.s 			page 4


 135:User/Src/delay.c **** #endif
 136:User/Src/delay.c ****     HAL_SYSTICK_CLKSourceConfig(SYSTICK_CLKSOURCE_HCLK);//SysTickÈ¢ëÁéá‰∏∫HCLK
  39              		.loc 1 136 5 is_stmt 1 view .LVU2
  40 0004 0420     		movs	r0, #4
  41              	.LVL1:
  42              		.loc 1 136 5 is_stmt 0 view .LVU3
  43 0006 FFF7FEFF 		bl	HAL_SYSTICK_CLKSourceConfig
  44              	.LVL2:
 137:User/Src/delay.c **** 	fac_us=SYSCLK;						//‰∏çËÆ∫ÊòØÂê¶‰ΩøÁî®OS,fac_usÈÉΩÈúÄË¶Å‰ΩøÁî®
  45              		.loc 1 137 2 is_stmt 1 view .LVU4
  46              		.loc 1 137 8 is_stmt 0 view .LVU5
  47 000a 014B     		ldr	r3, .L3
  48 000c 1C60     		str	r4, [r3]
 138:User/Src/delay.c **** #if SYSTEM_SUPPORT_OS 						//Â¶ÇÊûúÈúÄË¶ÅÊîØÊåÅOS.
 139:User/Src/delay.c **** 	reload=SYSCLK;					    //ÊØèÁßíÈíüÁöÑËÆ°Êï∞Ê¨°Êï∞ Âçï‰Ωç‰∏∫K	   
 140:User/Src/delay.c **** 	reload*=1000000/delay_ostickspersec;	//Ê†πÊçÆdelay_ostickspersecËÆæÂÆöÊ∫¢Âá∫Êó∂Èó¥
 141:User/Src/delay.c **** 											//reload‰∏∫24‰ΩçÂØÑÂ≠òÂô®,ÊúÄÂ§ßÂÄº:16777216,Âú®72M‰∏ã,Á∫¶Âêà0.233sÂ∑¶Âè≥	
 142:User/Src/delay.c **** 	fac_ms=1000/delay_ostickspersec;		//‰ª£Ë°®OSÂèØ‰ª•Âª∂Êó∂ÁöÑÊúÄÂ∞ëÂçï‰Ωç	   
 143:User/Src/delay.c **** 	SysTick->CTRL|=SysTick_CTRL_TICKINT_Msk;//ÂºÄÂêØSYSTICK‰∏≠Êñ≠
 144:User/Src/delay.c **** 	SysTick->LOAD=reload; 					//ÊØè1/OS_TICKS_PER_SECÁßí‰∏≠Êñ≠‰∏ÄÊ¨°	
 145:User/Src/delay.c **** 	SysTick->CTRL|=SysTick_CTRL_ENABLE_Msk; //ÂºÄÂêØSYSTICK
 146:User/Src/delay.c **** #else
 147:User/Src/delay.c **** #endif
 148:User/Src/delay.c **** }								    
  49              		.loc 1 148 1 view .LVU6
  50 000e 10BD     		pop	{r4, pc}
  51              	.L4:
  52              		.align	2
  53              	.L3:
  54 0010 00000000 		.word	.LANCHOR0
  55              		.cfi_endproc
  56              	.LFE65:
  58              		.section	.text.delay_us,"ax",%progbits
  59              		.align	1
  60              		.global	delay_us
  61              		.syntax unified
  62              		.thumb
  63              		.thumb_func
  65              	delay_us:
  66              	.LVL3:
  67              	.LFB66:
 149:User/Src/delay.c **** 
 150:User/Src/delay.c **** #if SYSTEM_SUPPORT_OS 						//Â¶ÇÊûúÈúÄË¶ÅÊîØÊåÅOS.
 151:User/Src/delay.c **** //Âª∂Êó∂nus
 152:User/Src/delay.c **** //nus:Ë¶ÅÂª∂Êó∂ÁöÑusÊï∞.	
 153:User/Src/delay.c **** //nus:0~190887435(ÊúÄÂ§ßÂÄºÂç≥2^32/fac_us@fac_us=22.5)	    								   
 154:User/Src/delay.c **** void delay_us(u32 nus)
 155:User/Src/delay.c **** {		
 156:User/Src/delay.c **** 	u32 ticks;
 157:User/Src/delay.c **** 	u32 told,tnow,tcnt=0;
 158:User/Src/delay.c **** 	u32 reload=SysTick->LOAD;				//LOADÁöÑÂÄº	    	 
 159:User/Src/delay.c **** 	ticks=nus*fac_us; 						//ÈúÄË¶ÅÁöÑËäÇÊãçÊï∞ 
 160:User/Src/delay.c **** 	delay_osschedlock();					//ÈòªÊ≠¢OSË∞ÉÂ∫¶ÔºåÈò≤Ê≠¢ÊâìÊñ≠usÂª∂Êó∂
 161:User/Src/delay.c **** 	told=SysTick->VAL;        				//ÂàöËøõÂÖ•Êó∂ÁöÑËÆ°Êï∞Âô®ÂÄº
 162:User/Src/delay.c **** 	while(1)
 163:User/Src/delay.c **** 	{
 164:User/Src/delay.c **** 		tnow=SysTick->VAL;	
ARM GAS  C:\Users\11655\AppData\Local\Temp\cc9GeTq9.s 			page 5


 165:User/Src/delay.c **** 		if(tnow!=told)
 166:User/Src/delay.c **** 		{	    
 167:User/Src/delay.c **** 			if(tnow<told)tcnt+=told-tnow;	//ËøôÈáåÊ≥®ÊÑè‰∏Ä‰∏ãSYSTICKÊòØ‰∏Ä‰∏™ÈÄíÂáèÁöÑËÆ°Êï∞Âô®Â∞±ÂèØ‰ª•‰∫Ü
 168:User/Src/delay.c **** 			else tcnt+=reload-tnow+told;	    
 169:User/Src/delay.c **** 			told=tnow;
 170:User/Src/delay.c **** 			if(tcnt>=ticks)break;			//Êó∂Èó¥Ë∂ÖËøá/Á≠â‰∫éË¶ÅÂª∂ËøüÁöÑÊó∂Èó¥,ÂàôÈÄÄÂá∫.
 171:User/Src/delay.c **** 		}  
 172:User/Src/delay.c **** 	};
 173:User/Src/delay.c **** 	delay_osschedunlock();					//ÊÅ¢Â§çOSË∞ÉÂ∫¶											    
 174:User/Src/delay.c **** }  
 175:User/Src/delay.c **** //Âª∂Êó∂nms
 176:User/Src/delay.c **** //nms:Ë¶ÅÂª∂Êó∂ÁöÑmsÊï∞
 177:User/Src/delay.c **** //nms:0~65535
 178:User/Src/delay.c **** void delay_ms(u16 nms)
 179:User/Src/delay.c **** {	
 180:User/Src/delay.c **** 	if(delay_osrunning&&delay_osintnesting==0)//Â¶ÇÊûúOSÂ∑≤ÁªèÂú®Ë∑ë‰∫Ü,Âπ∂‰∏î‰∏çÊòØÂú®‰∏≠Êñ≠ÈáåÈù¢(‰∏
 181:User/Src/delay.c **** 	{		 
 182:User/Src/delay.c **** 		if(nms>=fac_ms)						//Âª∂Êó∂ÁöÑÊó∂Èó¥Â§ß‰∫éOSÁöÑÊúÄÂ∞ëÊó∂Èó¥Âë®Êúü 
 183:User/Src/delay.c **** 		{ 
 184:User/Src/delay.c ****    			delay_ostimedly(nms/fac_ms);	//OSÂª∂Êó∂
 185:User/Src/delay.c **** 		}
 186:User/Src/delay.c **** 		nms%=fac_ms;						//OSÂ∑≤ÁªèÊó†Ê≥ïÊèê‰æõËøô‰πàÂ∞èÁöÑÂª∂Êó∂‰∫Ü,ÈááÁî®ÊôÆÈÄöÊñπÂºèÂª∂Êó∂    
 187:User/Src/delay.c **** 	}
 188:User/Src/delay.c **** 	delay_us((u32)(nms*1000));				//ÊôÆÈÄöÊñπÂºèÂª∂Êó∂
 189:User/Src/delay.c **** }
 190:User/Src/delay.c **** #else  //‰∏çÁî®ucosÊó∂
 191:User/Src/delay.c **** 
 192:User/Src/delay.c **** //Âª∂Êó∂nus
 193:User/Src/delay.c **** //nus‰∏∫Ë¶ÅÂª∂Êó∂ÁöÑusÊï∞.	
 194:User/Src/delay.c **** //nus:0~190887435(ÊúÄÂ§ßÂÄºÂç≥2^32/fac_us@fac_us=22.5)	 
 195:User/Src/delay.c **** void delay_us(u32 nus)
 196:User/Src/delay.c **** {		
  68              		.loc 1 196 1 is_stmt 1 view -0
  69              		.cfi_startproc
  70              		@ args = 0, pretend = 0, frame = 0
  71              		@ frame_needed = 0, uses_anonymous_args = 0
  72              		@ link register save eliminated.
  73              		.loc 1 196 1 is_stmt 0 view .LVU8
  74 0000 10B4     		push	{r4}
  75              	.LCFI1:
  76              		.cfi_def_cfa_offset 4
  77              		.cfi_offset 4, -4
 197:User/Src/delay.c **** 	u32 ticks;
  78              		.loc 1 197 2 is_stmt 1 view .LVU9
 198:User/Src/delay.c **** 	u32 told,tnow,tcnt=0;
  79              		.loc 1 198 2 view .LVU10
  80              	.LVL4:
 199:User/Src/delay.c **** 	u32 reload=SysTick->LOAD;				//LOADÁöÑÂÄº	    	 
  81              		.loc 1 199 2 view .LVU11
  82              		.loc 1 199 6 is_stmt 0 view .LVU12
  83 0002 4FF0E022 		mov	r2, #-536813568
  84 0006 5469     		ldr	r4, [r2, #20]
  85              	.LVL5:
 200:User/Src/delay.c **** 	ticks=nus*fac_us; 						//ÈúÄË¶ÅÁöÑËäÇÊãçÊï∞ 
  86              		.loc 1 200 2 is_stmt 1 view .LVU13
  87              		.loc 1 200 11 is_stmt 0 view .LVU14
  88 0008 0B4B     		ldr	r3, .L12
ARM GAS  C:\Users\11655\AppData\Local\Temp\cc9GeTq9.s 			page 6


  89 000a 1B68     		ldr	r3, [r3]
  90              		.loc 1 200 7 view .LVU15
  91 000c 00FB03FC 		mul	ip, r0, r3
  92              	.LVL6:
 201:User/Src/delay.c **** 	told=SysTick->VAL;        				//ÂàöËøõÂÖ•Êó∂ÁöÑËÆ°Êï∞Âô®ÂÄº
  93              		.loc 1 201 2 is_stmt 1 view .LVU16
  94              		.loc 1 201 6 is_stmt 0 view .LVU17
  95 0010 9369     		ldr	r3, [r2, #24]
  96              	.LVL7:
 198:User/Src/delay.c **** 	u32 reload=SysTick->LOAD;				//LOADÁöÑÂÄº	    	 
  97              		.loc 1 198 16 view .LVU18
  98 0012 0021     		movs	r1, #0
  99 0014 04E0     		b	.L9
 100              	.LVL8:
 101              	.L7:
 202:User/Src/delay.c **** 	while(1)
 203:User/Src/delay.c **** 	{
 204:User/Src/delay.c **** 		tnow=SysTick->VAL;	
 205:User/Src/delay.c **** 		if(tnow!=told)
 206:User/Src/delay.c **** 		{	    
 207:User/Src/delay.c **** 			if(tnow<told)tcnt+=told-tnow;	//ËøôÈáåÊ≥®ÊÑè‰∏Ä‰∏ãSYSTICKÊòØ‰∏Ä‰∏™ÈÄíÂáèÁöÑËÆ°Êï∞Âô®Â∞±ÂèØ‰ª•‰∫Ü
 208:User/Src/delay.c **** 			else tcnt+=reload-tnow+told;	    
 102              		.loc 1 208 9 is_stmt 1 view .LVU19
 103              		.loc 1 208 21 is_stmt 0 view .LVU20
 104 0016 E01A     		subs	r0, r4, r3
 105              		.loc 1 208 26 view .LVU21
 106 0018 0244     		add	r2, r2, r0
 107              	.LVL9:
 108              		.loc 1 208 13 view .LVU22
 109 001a 1144     		add	r1, r1, r2
 110              	.LVL10:
 111              	.L8:
 209:User/Src/delay.c **** 			told=tnow;
 112              		.loc 1 209 4 is_stmt 1 view .LVU23
 210:User/Src/delay.c **** 			if(tcnt>=ticks)break;			//Êó∂Èó¥Ë∂ÖËøá/Á≠â‰∫éË¶ÅÂª∂ËøüÁöÑÊó∂Èó¥,ÂàôÈÄÄÂá∫.
 113              		.loc 1 210 4 view .LVU24
 114              		.loc 1 210 6 is_stmt 0 view .LVU25
 115 001c 6145     		cmp	r1, ip
 116 001e 09D2     		bcs	.L11
 117              	.LVL11:
 118              	.L9:
 198:User/Src/delay.c **** 	u32 reload=SysTick->LOAD;				//LOADÁöÑÂÄº	    	 
 119              		.loc 1 198 16 view .LVU26
 120 0020 1A46     		mov	r2, r3
 121              	.LVL12:
 122              	.L6:
 202:User/Src/delay.c **** 	{
 123              		.loc 1 202 2 is_stmt 1 view .LVU27
 204:User/Src/delay.c **** 		if(tnow!=told)
 124              		.loc 1 204 3 view .LVU28
 204:User/Src/delay.c **** 		if(tnow!=told)
 125              		.loc 1 204 7 is_stmt 0 view .LVU29
 126 0022 4FF0E023 		mov	r3, #-536813568
 127 0026 9B69     		ldr	r3, [r3, #24]
 128              	.LVL13:
 205:User/Src/delay.c **** 		{	    
 129              		.loc 1 205 3 is_stmt 1 view .LVU30
ARM GAS  C:\Users\11655\AppData\Local\Temp\cc9GeTq9.s 			page 7


 205:User/Src/delay.c **** 		{	    
 130              		.loc 1 205 5 is_stmt 0 view .LVU31
 131 0028 9A42     		cmp	r2, r3
 132 002a FAD0     		beq	.L6
 207:User/Src/delay.c **** 			else tcnt+=reload-tnow+told;	    
 133              		.loc 1 207 4 is_stmt 1 view .LVU32
 207:User/Src/delay.c **** 			else tcnt+=reload-tnow+told;	    
 134              		.loc 1 207 6 is_stmt 0 view .LVU33
 135 002c F3D9     		bls	.L7
 207:User/Src/delay.c **** 			else tcnt+=reload-tnow+told;	    
 136              		.loc 1 207 17 is_stmt 1 discriminator 1 view .LVU34
 207:User/Src/delay.c **** 			else tcnt+=reload-tnow+told;	    
 137              		.loc 1 207 27 is_stmt 0 discriminator 1 view .LVU35
 138 002e D21A     		subs	r2, r2, r3
 139              	.LVL14:
 207:User/Src/delay.c **** 			else tcnt+=reload-tnow+told;	    
 140              		.loc 1 207 21 discriminator 1 view .LVU36
 141 0030 1144     		add	r1, r1, r2
 142              	.LVL15:
 207:User/Src/delay.c **** 			else tcnt+=reload-tnow+told;	    
 143              		.loc 1 207 21 discriminator 1 view .LVU37
 144 0032 F3E7     		b	.L8
 145              	.LVL16:
 146              	.L11:
 211:User/Src/delay.c **** 		}  
 212:User/Src/delay.c **** 	};
 213:User/Src/delay.c **** }
 147              		.loc 1 213 1 view .LVU38
 148 0034 10BC     		pop	{r4}
 149              	.LCFI2:
 150              		.cfi_restore 4
 151              		.cfi_def_cfa_offset 0
 152              	.LVL17:
 153              		.loc 1 213 1 view .LVU39
 154 0036 7047     		bx	lr
 155              	.L13:
 156              		.align	2
 157              	.L12:
 158 0038 00000000 		.word	.LANCHOR0
 159              		.cfi_endproc
 160              	.LFE66:
 162              		.section	.text.delay_ms,"ax",%progbits
 163              		.align	1
 164              		.global	delay_ms
 165              		.syntax unified
 166              		.thumb
 167              		.thumb_func
 169              	delay_ms:
 170              	.LVL18:
 171              	.LFB67:
 214:User/Src/delay.c **** 
 215:User/Src/delay.c **** //Âª∂Êó∂nms
 216:User/Src/delay.c **** //nms:Ë¶ÅÂª∂Êó∂ÁöÑmsÊï∞
 217:User/Src/delay.c **** void delay_ms(u16 nms)
 218:User/Src/delay.c **** {
 172              		.loc 1 218 1 is_stmt 1 view -0
 173              		.cfi_startproc
ARM GAS  C:\Users\11655\AppData\Local\Temp\cc9GeTq9.s 			page 8


 174              		@ args = 0, pretend = 0, frame = 0
 175              		@ frame_needed = 0, uses_anonymous_args = 0
 176              		.loc 1 218 1 is_stmt 0 view .LVU41
 177 0000 38B5     		push	{r3, r4, r5, lr}
 178              	.LCFI3:
 179              		.cfi_def_cfa_offset 16
 180              		.cfi_offset 3, -16
 181              		.cfi_offset 4, -12
 182              		.cfi_offset 5, -8
 183              		.cfi_offset 14, -4
 184 0002 0546     		mov	r5, r0
 219:User/Src/delay.c **** 	u32 i;
 185              		.loc 1 219 2 is_stmt 1 view .LVU42
 220:User/Src/delay.c **** 	for(i=0;i<nms;i++) delay_us(1000);
 186              		.loc 1 220 2 view .LVU43
 187              	.LVL19:
 188              		.loc 1 220 7 is_stmt 0 view .LVU44
 189 0004 0024     		movs	r4, #0
 190              		.loc 1 220 2 view .LVU45
 191 0006 04E0     		b	.L15
 192              	.LVL20:
 193              	.L16:
 194              		.loc 1 220 21 is_stmt 1 discriminator 3 view .LVU46
 195 0008 4FF47A70 		mov	r0, #1000
 196 000c FFF7FEFF 		bl	delay_us
 197              	.LVL21:
 198              		.loc 1 220 16 discriminator 3 view .LVU47
 199              		.loc 1 220 17 is_stmt 0 discriminator 3 view .LVU48
 200 0010 0134     		adds	r4, r4, #1
 201              	.LVL22:
 202              	.L15:
 203              		.loc 1 220 10 is_stmt 1 discriminator 1 view .LVU49
 204              		.loc 1 220 2 is_stmt 0 discriminator 1 view .LVU50
 205 0012 A542     		cmp	r5, r4
 206 0014 F8D8     		bhi	.L16
 221:User/Src/delay.c **** }
 207              		.loc 1 221 1 view .LVU51
 208 0016 38BD     		pop	{r3, r4, r5, pc}
 209              		.loc 1 221 1 view .LVU52
 210              		.cfi_endproc
 211              	.LFE67:
 213              		.section	.bss.fac_us,"aw",%nobits
 214              		.align	2
 215              		.set	.LANCHOR0,. + 0
 218              	fac_us:
 219 0000 00000000 		.space	4
 220              		.text
 221              	.Letext0:
 222              		.file 2 "c:\\program files (x86)\\gnu arm embedded toolchain\\10 2021.10\\arm-none-eabi\\include\\
 223              		.file 3 "c:\\program files (x86)\\gnu arm embedded toolchain\\10 2021.10\\arm-none-eabi\\include\\
 224              		.file 4 "Drivers/CMSIS/Include/core_cm3.h"
 225              		.file 5 "User/Inc/sys.h"
 226              		.file 6 "Drivers/STM32F1xx_HAL_Driver/Inc/stm32f1xx_hal_cortex.h"
ARM GAS  C:\Users\11655\AppData\Local\Temp\cc9GeTq9.s 			page 9


DEFINED SYMBOLS
                            *ABS*:00000000 delay.c
C:\Users\11655\AppData\Local\Temp\cc9GeTq9.s:18     .text.delay_init:00000000 $t
C:\Users\11655\AppData\Local\Temp\cc9GeTq9.s:24     .text.delay_init:00000000 delay_init
C:\Users\11655\AppData\Local\Temp\cc9GeTq9.s:54     .text.delay_init:00000010 $d
C:\Users\11655\AppData\Local\Temp\cc9GeTq9.s:59     .text.delay_us:00000000 $t
C:\Users\11655\AppData\Local\Temp\cc9GeTq9.s:65     .text.delay_us:00000000 delay_us
C:\Users\11655\AppData\Local\Temp\cc9GeTq9.s:158    .text.delay_us:00000038 $d
C:\Users\11655\AppData\Local\Temp\cc9GeTq9.s:163    .text.delay_ms:00000000 $t
C:\Users\11655\AppData\Local\Temp\cc9GeTq9.s:169    .text.delay_ms:00000000 delay_ms
C:\Users\11655\AppData\Local\Temp\cc9GeTq9.s:214    .bss.fac_us:00000000 $d
C:\Users\11655\AppData\Local\Temp\cc9GeTq9.s:218    .bss.fac_us:00000000 fac_us

UNDEFINED SYMBOLS
HAL_SYSTICK_CLKSourceConfig
